# DNS工作原理

## DNS域名结构

**study**.google.com.(注意后面有一个点代表根域名)

.:根域名

.com:顶级域名(一级域名)

.google:二级域名

**study:主机名**

## 本地DNS(hosts)

存储**ip地址**和**域名**之间的对应关系,优先级高于网络DNS

```
127.0.0.1 localhost
1.1.1.1 www.baidu.com
```

windows:%WINDIR%/system32/drivers/etc/hosts

linux:/etc/hosts

## 本地默认DNS服务器

#### Linux:

1. 查看/etc/resolv.conf:如果没有 #Generated by ... 就可以直接配置resolv.conf
   1. 如果是systemd-resolved就systemctl disable systemd-resolved
2. 通过nslookup查看当前生效的dns服务器:输入server

## DNS服务器

- 如果有很多客户端(10000台)不可能每一台都自己配置hosts,需要有DNS服务器提供查询服务

- 只有一台DNS服务器容易坏(怎么解决?)

- **权威域名服务器:查询主机名ip所在的dns服务器(eg:google.com查询translate.google.com)**,一般的网站都会有自己的权威域名服务器用来对公司内部的主机进行dns解析(公司内部一般都是DHCP)

## DNS解析

解析类型:

- 正向解析:从域名(FQDN)到IP
- 反向解析:从IP到域名(FQDN)

DNS解析过程(如果找到就不再继续):

1. 先查询本地hosts文件
2. 再查询DNS服务器缓存
3. DNS服务器迭代查询:根服务器==>顶级域名服务器==>权威域名服务器

# DNS服务功能基本实现

## 配置DNS记录(域名服务商)

记录类型:

- A记录:

注意:

- 使用*作为主机名代表全匹配(防止用户输入错误):

```dns
*.sciform.one.	107.173.181.210
```

- 使用@作为主机名代表匹配本域名

```dns
@.sciform.one.	107.173.181.210//等价于sciform.one.
```

## BIND9使用

#### 安装:

```bash
apt-get install bind9 bind9-doc dnsutils
```

- 开启53端口的tcp/udp防火墙
- 开启953端口的tcp防火墙

#### 配置文件

```conf
/etc/bind/named.conf:总体的配置文件(include其他配置文件)
/etc/bind/named.conf.default-zones:存储
$系统服务路径/named.service:启动
```

#### 启动服务

```bash
systemctl start named
```



